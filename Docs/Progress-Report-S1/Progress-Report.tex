\documentclass[onecolumn, draftclsnofoot,10pt, compsoc]{IEEEtran}
\usepackage{graphicx}
\usepackage{url}
\usepackage{setspace}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage{longtable}

\usepackage{geometry}
\geometry{textheight=9.5in, textwidth=7in}

% Listings settings for swift taken from chriseidhof GitHub
\lstdefinelanguage{swift}
{
  morekeywords={
    func,if,then,else,for,in,while,do,switch,case,default,where,break,continue,fallthrough,return,
    typealias,struct,class,enum,protocol,var,func,let,get,set,willSet,didSet,inout,init,deinit,extension,
    subscript,prefix,operator,infix,postfix,precedence,associativity,left,right,none,convenience,dynamic,
    final,lazy,mutating,nonmutating,optional,override,required,static,unowned,safe,weak,internal,
    private,public,is,as,self,unsafe,dynamicType,true,false,nil,Type,Protocol,
  },
  morecomment=[l]{//}, % l is for line comment
  morecomment=[s]{/*}{*/}, % s is for start and end delimiter
  morestring=[b]" % defines that strings are enclosed in double quotes
}

\definecolor{keyword}{HTML}{BA2CA3}
\definecolor{string}{HTML}{D12F1B}
\definecolor{comment}{HTML}{008400}

\lstset{
  language=swift,
  basicstyle=\ttfamily,
  showstringspaces=false, % lets spaces in strings appear as real spaces
  columns=fixed,
  keepspaces=true,
  keywordstyle=\color{keyword},
  stringstyle=\color{string},
  commentstyle=\color{comment},
}

% 1. Fill in these details
\def \CapstoneTeamName{Manovacumeter Team}
\def \CapstoneTeamNumber{ 20}
\def \GroupMemberOne{Cade Raichart}
\def \GroupMemberTwo{Daniel Kato}
\def \GroupMemberThree{Nathan Shepherd}
\def \CapstoneProjectName{ISS Barometer App }
\def \CapstoneSponsorCompany{NASA}
\def \CapstoneSponsorPerson{Don Pettit}

% 2. Uncomment the appropriate line below so that the document type works
\def \DocType{Progress Report}

\newcommand{\NameSigPair}[1]{\par
\makebox[2.75in][r]{#1} \hfil 	\makebox[3.25in]{\makebox[2.25in]{\hrulefill} \hfill		\makebox[.75in]{\hrulefill}}
\par\vspace{-12pt} \textit{\tiny\noindent
\makebox[2.75in]{} \hfil		\makebox[3.25in]{\makebox[2.25in][r]{Signature} \hfill	\makebox[.75in][r]{Date}}}}
% 3. If the document is not to be signed, uncomment the RENEWcommand below
%\renewcommand{\NameSigPair}[1]{#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\begin{titlepage}
    \pagenumbering{gobble}
    \begin{singlespace}
    	\includegraphics[height=4cm]{coe_v_spot1}
        \hfill
        % 4. If you have a logo, use this includegraphics command to put it on the coversheet.
        %\includegraphics[height=4cm]{NASA}
        \par\vspace{.2in}
        \centering
        \scshape{
            \huge CS Capstone \DocType \par
            {\large\today}\par
            \vspace{.5in}
            \textbf{\Huge\CapstoneProjectName}\par
            \vfill
            {\large Prepared for}\par
            \Huge \CapstoneSponsorCompany\par
            \vspace{5pt}
            {\Large\NameSigPair{\CapstoneSponsorPerson}\par}
            {\large Prepared by }\par
            Group\CapstoneTeamNumber\par
            % 5. comment out the line below this one if you do not wish to name your team
            %\CapstoneTeamName\par
            \vspace{5pt}
            {\Large
                \NameSigPair{\GroupMemberTwo}\par
            }
            \vspace{20pt}
        }
        \begin{abstract}
        % 6. Fill in your abstract
        The International Space Station, the conglomerate work of multiple national space associations, including NASA, requires precision devices to monitor the many aspects of space life.
        One very important aspect for the success of life in near vacuum is sustained air pressure inside the modules.
        This air pressure is monitored by mechanical barometers, called Manovacometers, which must be visually monitored, and are no longer available.
        The \CapstoneProjectName seeks to provide a suitable replacement for the current barometer device aboard the International Space Station.
        This document will update the reader on our progress, from the last Fall term Progress report.
        Each member has written their progress and plans, as well as a main refresher on our project as a whole.
        The member sections include Responsibilities, Current Status, Remaining Tasks, Problems Faced, and additional relevant or interesting details.
        This document should provide a clear picture of where the project stands, halfway through the Winter term, and halfway through the allotted year.
        \end{abstract}
    \end{singlespace}
\end{titlepage}
\newpage
\pagenumbering{arabic}
\tableofcontents
% 7. uncomment this (if applicable). Consider adding a page break.
%\listoffigures
%\listoftables
\clearpage

% 8. now you write!
\section{Project Purpose}
The ISS Barometer Application will be used on the ISS to measure and track air pressure.
The crew members aboard the ISS are currently reliant on mechanical barometers to take critical readings during leaks, or rapid depressurization events.
These leaks, caused by orbital debris, must be found and patched or the crew would need to evacuate.
Our application will improve on the mechanical barometers by providing clear and accurate pressure readings through the iPads on-board barometer sensor.
Readouts and measurements will be presented in a easy-to-read fashion that will allow users to quickly gauge the important details.
In further iterations, we plan to implement contextualized audio data readouts by using the t-Res document and a simple Swift api \cite{probStat}.

\section{Project Goals}
As mentioned above the application we are making will provide ISS crew members with an accurate and efficient pressure reading.
Our required features follow that purpose and are listed below:
\begin{itemize}
\item[V1:] Display screen and a Settings pages
\item [V1:] Display screen shows current pressure, delta, average change in pressure over time, average change in time over change in pressure and timestamps
\item[V1:]  Display screen shows Graph Screen with plot pressure as a function of time
\item[V1:] Settings Page that includes plot scale, scroll functionality, orientation, decimal point, units of measure for pressure and minimum pressure
\item[V1:] All items will be optimized for efficient reading and clear interface
\item[V2:] Graph will have pinch to zoom functionality, scaling options (to be set in settings)
\item[V2:] Graph will be able to be exported as a csv, excel readable file
\item[V2:] Graph can be compared to t-Res table, to measure time remaining
\end{itemize}

Along with these specific features, the application that we create must be efficient and clear, as decided by the users.
The application will be used in challenging situations and must be clear and easy to understand, so that the data can be conveyed quickly and without confusion.
From the listed project goals, we have sufficiently finished with V1, and have started implementing portions of V2, while trying to finalize our V1 progress.


\section{Current Status}
    We are currently updating the UI and adding a few features that Don requested in response to seeing our alpha version of the app.
    This alpha version includes a main UI with readings of current pressure and time, change in pressure since button press and time of press, average $\frac{\Delta p}{\Delta t}$ and $\frac{\Delta t}{\Delta p}$ since button press and time of press, and a chart of pressure over time.
    The delta reading has a corresponding button that when pressed updates the display with the change in pressure since the last time the button was pressed.
    Similarly, the average $\frac{\Delta p}{\Delta t}$ and $\frac{\Delta t}{\Delta p}$ readings have a corresponding buttons that when pressed updates the display with the average $\frac{\Delta p}{\Delta t}$ and $\frac{\Delta t}{\Delta p}$ since the last button press.

    The chart is currently displays the current pressure as a function of time with the ability to pinch to zoom.
    The x-axis displays the time of the reading in the format determined for the system in the system settings app.
    Whenever the units for the graph are changed, the y-axis points are converted to reflect the new unit of measurement while maintaining the shape of the graph.

    The settings page currently allows for the configuration of units, significant digits, orientation, and graph style.
    The available units are mmHg, psi, kPa, and atm.
    The significant digit allow for between 0 and 10 significant digits.
    The orientation allows for the orientation to be up, down, left, or right compared to the default orientation (camera above display and home button below).

    \subsection{Remaining Tasks}
        The application still needs to include axis labels, and have the UI updated, before having a complete alpha version.
        Once the alpha has been accepted, we will incorporate the existing T-res chart into our application as well as a reading that displays the amount of time before an evacuation is necessary.
        We will also incorporate a vocal readout of the amount of time left, and the ability to lock the screen from touch input unless a lock icon is pressed again.
        We also need to redesign the app icon to depict the ISS with a hole in it with air escaping.

\section{Problems Faced}

\subsection{Orientation} 
Our first problem that we fasted was locking the orientation and then being able to reorient the display to the users’ preferences.
We spent hours searching the web for help and mostly came up with ideas and code that just didn't work such as:

\begin{lstlisting}
static func lockOrientation(_ orientation: UIInterfaceOrientationMask, andRotateTo rotateOrientation:UIInterfaceOrientation) {self.lockOrientation(orientation)}
\end{lstlisting}

   We found a lot of code like this, that potentially could have worked, but when implemented didn't lock the screen or allow you to switch your orientation.
    In fact, most research told me i could use the code “ self.lockOrientation(left)” to lock the screen but i was unsuccessful.
   The Solution we found was using the call to {UIDevice.current.setValue(<orientationInt>, forKey: "orientation")} to fix the orientation, so that the user could orient the screen however they wanted.


\subsection{Stack}
    Another problem we faced was orienting the stacks so that they were all aligned.
    There were no instructions on how to use the \texttt{viewController} stacks online, so we had to manually adjust the stacks until we found a solution.
    This solution was using more stacks within each other and making sure every single stack was correctly aligned with the previous one.

\subsection{Rolling screen }

The problems faced involved my efforts on rolling screen functionality and axis titles.
The rolling screen functionality was the setting that allowed users to select the charts display mode.
To implement rolling screen we had to set the minimum and maximum x axis for each data point added.
It was simple enough to write this functionality but to make it call at regular intervals proved trickier.
The solution we implemented was a timer object, that would activate each second, similar to the barometer polling.
This allowed for the settings that affected the barometer, such as the units, to also change the debug data.

\subsection{Axis titles}
It comes from the fact that as a team, we want to have axis aligned titles, with the y-axis title being vertically orientated.
It is only a single command that rotates the label, and is not really a challenge, but once rotated, Xcode's auto-formatting no longer applies.
This means that size constraints that are applied before the rotation of the label are, for the most part, disregarded, as shown in the images below in fig \ref{fig:comparison}.

\begin{figure}[H]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=.4\linewidth]{widthAxis}
  \caption{Label with width constraints}
  \label{fig:width}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=.4\linewidth]{heightAxis}
  \caption{Label with height constraints}
  \label{fig:height}
\end{subfigure}
\caption{A comparison of constraints on y axis label.}
\label{fig:comparison}
\end{figure}

By fixing the width, the location of the label is affected, making the margin a ridiculous waste of space.
When I try to fix this issue by also fixing the height of the label, the result is a truncated label.
The solution that we were able to arrive at involved changing the implemented workspace technique, of using \texttt{Stacks}, to now using \texttt{Views}.
This allows for more detailed adjustments, making it possible to constrain labels with position, and not just size.
The result, shown in fig \ref{fig:comparison}, is the current solution.
By using the following code, I am able to adjust the size of the label, after it is rotated.

\begin{lstlisting}
func adjustAxisLabels() {
    yAxisLabel.transform = CGAffineTransform(rotationAngle: -CGFloat.pi/2)
    yAxisLabel.text = "Pressure (\(settings.units))"
    yAxisLabel.sizeToFit()
}
\end{lstlisting}

\begin{figure}[H]
  \centering
  \includegraphics[width=.3\linewidth]{solution}
  \caption{The current solution of the label issue.}
  \label{fig:solution}
\end{figure}


\section{Relevant and Interesting Details}
\subsection{Code use}
    After completing the settings UI, we needed the settings to persist from use to use.
    To solution to this problem was UserDefaults which allows you to store serialized objects and retrieve them by an ID later is the class conforms to the \texttt{Codable} class.
    The code to implement this was very easy to read and implement and is as follows:

\begin{lstlisting}
// Settings Object
class Settings: Codable {
    var units = "mmHg"
    var sigFigs = 4
    var orientation = "Right"
    var slidingScale = false
    var slidingScaleThreshold = 20
    var windowSize = 50
}

// Store Settings Object
UserDefaults.standard.set(try? PropertyListEncoder().encode(settings), forKey: "Settings")

// Retrieve Settings Object
func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {
    if let data = UserDefaults.standard.value(forKey: "Settings") as? Data {
        settings = try? PropertyListDecoder().decode(Settings.self, from: data)
    }
    if settings == nil {
        settings = Settings()
    }
    return true
}

\end{lstlisting}


\subsection{Adaptation to space }

Another thing that interested me was the adaptions requested for use aboard the ISS.
I think that the applications use in microgravity and emergency situations is the most interesting detail of this project.
The adaptions include things like the locked orientation and audio readout, as well as large font and clear typeface choices.
It will be particularly interesting to deploy our application and hear feedback from real users.


\subsection{Display}

The most interesting thing i have found is how viewcontrollers are easy to use for simple programs because swift and Xcode have made it easy to drag and drop items.
However, viewcontrollers create an organization problem for more in depth programs, because these items easily overlap making them hard to move.
We started to use stacks that allowed us to make it easier to group items together and make them less cluttered.
Although the \texttt{viewController} is useful for small apps, if this app were more extensive I would try to avoid the use of the \texttt{viewController} and remove it from the program.


\section{Retrospective}
\begin{center}
	\begin{longtable}{| l | p{0.28\linewidth} | p{0.28\linewidth} | p{0.28\linewidth} |}
		\hline
		& Positives & Deltas & Actions \\ \hline
    Week 1 & During Spring break, axis labels were finalized & An article report, client wasn't able to run application & Work on the article was started \\ \hline
	Week 2 & Signed up for Expo & Article and poster were due & Article was completed \\ \hline
	Week 3 & Poster was finalized & Poster had some font issues & Font issues were resolved, poster was submitted \\ \hline
	Week 4 & Work started on the tRes display & Need to meet with Don to get feedback & Set up meeting with Don \\ \hline
  Week 5 & tRes was completed & Realized that tRes wasn't linear & tRes needs to be calculated differently, progress report and presentation completed \\ \hline
\end{longtable}
\end{center}

\newpage
\bibliographystyle{IEEEtran}
\bibliography{bibliography}

\end{document}
